<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Roxy quiz testing 1.0</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      width: 100%;
      max-width: 800px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
      padding: 24px 24px 32px;
    }
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 10px;
    }
    .title {
      font-size: 20px;
      font-weight: 600;
    }
    /* å·²ç­”å¾½ç« ï¼šç«çº¢åº• + ç²‰å­— */
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: #ff1493;  /* ç«çº¢åº• */
      color: #ffe4f0;       /* ç²‰è‰²å­— */
    }
    .progress {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0 16px;
      font-size: 14px;
      color: #6b7280;
    }
    .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
    }
    .progress-bar-inner {
      position: absolute;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #3b82f6, #6366f1);
      transition: width 0.25s ease;
    }
    .question-card {
      margin-top: 12px;
      padding: 16px 18px;
      border-radius: 16px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .question-text {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    .question-meta {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    .options {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .option-item {
      margin-bottom: 8px;
    }
    .option-label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid transparent;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s, transform 0.05s;
    }
    .option-label:hover {
      background: #f3f4ff;
      border-color: #c7d2fe;
      transform: translateY(-1px);
    }
    .option-label input {
      accent-color: #3b82f6;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 16px;
      gap: 12px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.2s, transform 0.05s, box-shadow 0.1s;
      white-space: nowrap;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }
    .btn-primary {
      background: linear-gradient(90deg, #2563eb, #4f46e5);
      color: white;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
    }
    .btn-primary:hover {
      filter: brightness(1.05);
    }
    .btn-danger {
      background: #ef4444;
      color: white;
    }
    .btn-danger:hover {
      filter: brightness(1.05);
    }
    .btn-ghost {
      background: transparent;
      color: #6b7280;
    }
    .btn-ghost:hover {
      background: #f3f4f6;
    }
    /* ä¸‹ä¸€é¢˜ï¼šç²‰è‰²æŒ‰é’® */
    .btn-pink {
      background: #ff69b4;
      color: #ffffff;
      box-shadow: 0 6px 16px rgba(255, 105, 180, 0.3);
    }
    .btn-pink:hover {
      filter: brightness(1.05);
    }
    /* æäº¤è¯•å·ï¼šé»‘è‰²æŒ‰é’® */
    .btn-dark {
      background: #000000;
      color: #ffffff;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
    }
    .btn-dark:hover {
      filter: brightness(1.05);
    }
    .hidden {
      display: none;
    }
    .result {
      margin-top: 16px;
      padding: 16px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
    }
    .score-line {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .score-tag {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 10px;
    }
    .result-detail {
      max-height: 350px;
      overflow-y: auto;
      margin-top: 10px;
      padding-right: 4px;
    }
    .result-item {
      padding: 10px 8px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 13px;
    }
    .result-item:last-child {
      border-bottom: none;
    }
    .result-item.correct {
      background: #ecfdf3;
    }
    .result-item.wrong {
      background: #fef2f2;
    }
    .result-item-title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    .tag-correct {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #dcfce7;
      color: #15803d;
      margin-left: 4px;
    }
    .tag-wrong {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #fee2e2;
      color: #b91c1c;
      margin-left: 4px;
    }
    .small {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 6px;
    }
    @media (max-width: 600px) {
      .app {
        padding: 16px;
        border-radius: 12px;
      }
      .nav-buttons {
        flex-direction: column;
      }
      button {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div class="title">Roxy quiz testing 1.0</div>
      <div class="badge" id="answered-count">å·²ç­”ï¼š0 é¢˜</div>
    </div>

    <div class="progress">
      <span id="progress-text">ç¬¬ 1 é¢˜ / å…± 0 é¢˜</span>
      <span id="tip-text">ç­”å®Œæ‰€æœ‰é¢˜ç›®åç‚¹å‡»â€œQuiz DoneğŸ’“â€æŸ¥çœ‹ç»“æœå•¦ ğŸ‰</span>
    </div>
    <div class="progress-bar">
      <div class="progress-bar-inner" id="progress-bar-inner"></div>
    </div>

    <!-- é¢˜ç›®åŒºåŸŸ -->
    <div id="quiz-section">
      <div class="question-card">
        <div class="question-text" id="question-text">é¢˜å¹²</div>
        <div class="question-meta" id="question-meta">å•é€‰é¢˜ Â· 10 åˆ†</div>
        <ul class="options" id="options-container">
          <!-- åŠ¨æ€æ’å…¥é€‰é¡¹ -->
        </ul>
      </div>

      <!-- æŒ‰é’®é¡ºåºï¼šStep Back - Move Forwards - Quiz Done -->
      <div class="nav-buttons">
        <button id="prev-btn" class="btn-secondary" disabled>â† Step Back å›åˆ°è¿‡å»</button>
        <button id="next-btn" class="btn-pink">Move Forwards å‘å‰çœ‹ â†’</button>
        <button id="submit-btn" class="btn-dark">Quiz Done æˆ‘çˆ±ä½  ğŸ’“</button>
      </div>
    </div>

    <!-- ç»“æœåŒºåŸŸ -->
    <div id="result-section" class="hidden">
      <div class="result">
        <div class="score-line" id="score-line"></div>
        <div class="score-tag" id="score-tag"></div>
        <div class="small" id="score-extra"></div>

        <div class="result-detail" id="result-detail">
          <!-- æ¯é¢˜è¯¦æƒ… -->
        </div>
      </div>

      <div class="nav-buttons" style="margin-top:18px;">
        <button id="restart-btn" class="btn-secondary">Try Again è®©æˆ‘ä»¬é‡æ–°å¼€å§‹ğŸ•¤</button>
        <button id="back-edit-btn" class="btn-ghost">Let's Cheat æˆ‘è¦ä½œå¼Š ğŸ¤¡ / Erase Them æ©¡çš®æ“¦ âœï¸</button>
      </div>
    </div>
  </div>

  <script>
    // ========== é¢˜åº“å®šä¹‰ï¼šæ¯é¢˜ 10 åˆ†ï¼Œæ‰€æœ‰é€‰é¡¹éƒ½æ˜¯åŠ åˆ†é€‰ ==========
    const questions = [
      {
        id: 1,
        type: "single",
        score: 10,
        text: "Hi DreDreï¼Œçˆ±å¯¹ä½ æ¥è¯´æ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "2åªé åœ¨ä¸€èµ·çš„å°çŒ«" },
          { key: "B", text: "è€—æ—¶2å¹´å…»å‡ºä¸€é¢—æ–°æ ‘è‹—" },
          { key: "C", text: "æŸäº›åªå­˜åœ¨æƒ³è±¡é‡Œçš„ å¼ºçƒˆæ„Ÿå—" },
          { key: "D", text: "2åªå¸ƒæ»¡çš±çº¹çš„æ‰‹ ç´§ç´§ç‰µç€" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "æ„›ã—ã¦ã„ã¾ã™"
      },
      {
        id: 2,
        type: "single",
        score: 10,
        text: "ä½ ç†æƒ³çš„ä¼´ä¾£å…³ç³»æ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "ä¸¤æ£µç‹¬ç«‹çš„æ ‘ æ ¹ç³»åœ¨åœ°ä¸‹ç´§ç´§ç›¸è¿" },
          { key: "B", text: "ä¸€å›¢ç«ç„° äº’ç›¸ç‡ƒçƒ§ ç…§äº®å½¼æ­¤" },
          { key: "C", text: "ä¸€ä¸ªå®‰å…¨çš„æ´ç©´ å…±åŒæŠµå¾¡å¤–ç•Œçš„é£é›¨" },
          { key: "D", text: "ä¸¤åªä¸€åŒé£ç¿”çš„é¸Ÿç±» å…±åŒçœ‹è¿‡ä¸€ç‰‡é£æ™¯" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Te quiero"
      },
      {
        id: 3,
        type: "single",
        score: 10,
        text: "æ­¤åˆ»ä½ æ„Ÿå—åˆ°çš„ Roxy æ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "å‡¤å‡°å½¢çŠ¶çš„æ™šéœ" },
          { key: "B", text: "å¤æœ«åœ¨å‘Šåˆ«çš„äº‘" },
          { key: "C", text: "æ³³æ± ä¸­æº…å‡ºçš„å†°å‡‰æ°´èŠ±" },
          { key: "D", text: "é›·é›¨çš„å¤œæ™š" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Je tâ€™aime"
      },
      {
        id: 4,
        type: "single",
        score: 10,
        text: "ä½ æƒ³è±¡æ­¤åˆ»çš„ Roxy æ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "ä¸€åªé•¿ç€çº¢è‰²é¼»å­çš„é¼¹é¼  æ­£å¿™ç¢Œåœ°æŒ–æ´" },
          { key: "B", text: "ä¸€åªç²‰è‰²æ¯›å‘çš„å…”å­ ç”¨åè„šåŠªåŠ›æ¢³ç†è‡ªå·±çš„æ¯›å‘" },
          { key: "C", text: "ä¸€åªæ¯›è‰²è¾ƒæµ…çš„æ¢…èŠ±é¹¿ æ­£ç›¯ç€æ£®æ—çš„æ·±å¤„çœ‹" },
          { key: "D", text: "ä¸€åªæ‚ é—²çš„å°è±¡ ç”©ç€å°¾å·´ è·Ÿåœ¨å¤§è±¡èƒŒååƒè‰" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Ich liebe dich"
      },
      {
        id: 5,
        type: "single",
        score: 10,
        text: "å½“å…³ç³»ç»“æŸæ—¶ï¼Œä½ æ›´åƒæ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "å†°å°çš„ç«å±± å¤–å†·å†…çƒ­" },
          { key: "B", text: "æ”¹é“çš„æ²³æµ å¥”å‘æ˜¥å¤©çš„æµ·æ´‹" },
          { key: "C", text: "è¢«ç æ‰æå¹²çš„æ ‘ éœ€è¦æ¼«é•¿çš„æ˜¥å¤©æ‰èƒ½å‘èŠ½" },
          { key: "D", text: "è¢«é£å¹æ•£çš„äº‘ å½¢æ€æ”¹å˜ ä½†ä¾æ—§æ˜¯äº‘" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Ti amo"
      },
      {
        id: 6,
        type: "single",
        score: 10,
        text: "ä½ æ›´å¸Œæœ›å¦‚ä½•è¢«â€œè®°ä½â€ï¼Ÿ",
        options: [
          { key: "A", text: "ä¸€ä¸ªæœ‰è¶£çš„çµé­‚ ä¸€ä¸ªä¼ å¥‡çš„æ•…äº‹" },
          { key: "B", text: "ä¸€ä¸ªå¯é çš„æœ‹å‹ ä¸€ä¸ªæ¸©æš–çš„æ¸¯æ¹¾" },
          { key: "C", text: "ä¸€ä¸ªä¼˜é›…çš„è°œ ä¸€æ®µç¾ä¸½çš„é£æ™¯" },
          { key: "D", text: "ä¸€ä¸ªå¼ºå¤§çš„ç”Ÿå‘½ ä¸€æ®µæ—¶ä»£çš„å¼€å¯" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "ì‚¬ë‘í•©ë‹ˆë‹¤"
      },
      {
        id: 7,
        type: "single",
        score: 10,
        text: "ä½ è®¤ä¸ºâ€œæƒåŠ›â€çš„æœ¬è´¨æ˜¯ï¼Ÿ",
        options: [
          { key: "A", text: "åˆ¶å®šè§„åˆ™çš„èµ„æ ¼" },
          { key: "B", text: "ä¿æŠ¤æ‰€çˆ±ä¹‹äººçš„èƒ½åŠ›" },
          { key: "C", text: "ä¸€ç§å¯ä»¥äº¤æ¢ä¸€åˆ‡çš„ç­¹ç " },
          { key: "D", text: "ä¸€ç§æ²‰é‡çš„è´£ä»»" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Ğ¯ Ñ‚ĞµĞ±Ñ Ğ»ÑĞ±Ğ»Ñ"
      },
      {
        id: 8,
        type: "single",
        score: 10,
        text: "åœ¨çœŸå¿ƒè¯å¤§å†’é™©çš„æ¸¸æˆä¸­ä½ å‘ç°äº†ä¸€ä¸ª BUGï¼Œä½ ä¼šï¼Ÿ",
        options: [
          { key: "A", text: "æš—ä¸­åˆ©ç”¨ ç²¾å‡†åœ°è®©æŸäººè¯´å‡ºç§˜å¯†" },
          { key: "B", text: "å¤§å£°å‘Šè¯‰æ‰€æœ‰äºº ç„¶åç©ç‚¹æ›´åˆºæ¿€çš„" },
          { key: "C", text: "å‡è£…ä¸çŸ¥é“ ä½†æ˜¯é»˜é»˜è®°ä¸‹è¿™ä¸ª å‡†å¤‡ä¸‹æ¬¡è¯•è¯•" },
          { key: "D", text: "åˆ©ç”¨ BUG è®©æ¸¸æˆå’Œå¹³ç»“æŸ å»çœ‹ç”µå½±" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "Eu amo-te"
      },
      {
        id: 9,
        type: "single",
        score: 10,
        text: "ä½ å¦‚ä½•ç†è§£â€œçŸ­æš‚çš„åˆ†ç¦»â€ï¼Ÿ",
        options: [
          { key: "A", text: "æ˜¯æˆé•¿ ä¸ºäº†ä¸‹ä¸€æ¬¡æ›´å¥½çš„ç›¸é‡" },
          { key: "B", text: "å……æ»¡æœªçŸ¥ å……æ»¡å¸Œæœ›" },
          { key: "C", text: "ä¹Ÿè®¸æ˜¯å‘Šåˆ« ä¹Ÿè®¸æ˜¯å†ä¹Ÿä¸è§" },
          { key: "D", text: "æ˜¯æµªæ¼«çš„ç”Ÿæ´»å“²å­¦ é‡é€¢æ¯”ç›¸é‡æ›´æµªæ¼«" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "à¸‰à¸±à¸™à¸£à¸±à¸à¸„à¸¸à¸“"
      },
      {
        id: 10,
        type: "single",
        score: 10,
        text: "æœ€åä¸€é¢˜å•¦ï¼Œä½ å¸Œæœ›å¿«ç‚¹çœ‹åˆ°æµ‹è¯•ç»“æœå—ï¼Ÿ",
        options: [
          { key: "A", text: "æ€¥æ€¥æ€¥ æˆ‘æ˜¯æ€¥æ€¥å¤§å›½ç‹" },
          { key: "B", text: "ä¸æ€¥ å…¶ä¸­å¿…æœ‰è¯ˆ" },
          { key: "C", text: "å¥¹æ€ä¹ˆåˆè¯•æ¢æˆ‘" },
          { key: "D", text: "æˆ‘æ€ä¹ˆè°ˆäº†ä¸ªç”·çš„" }
        ],
        answerText: "æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæ¯ä¸ªé€‰é¡¹éƒ½å¾— 10 åˆ†ã€‚",
        explanation: "å¯¹ Roxy æ¥è¯´ï¼Œçˆ±æ˜¯ç”¨æ‰€æœ‰è¯­è¨€éƒ½è¯´ä¸€éæˆ‘çˆ±ä½ ã€‚"
      }
    ];

    // ========== çŠ¶æ€ ==========
    let currentIndex = 0; // å½“å‰é¢˜ç›®ç´¢å¼•
    const userAnswers = {}; // {0:["A"],1:["B"]...}

    // ========== DOM å…ƒç´  ==========
    const questionTextEl = document.getElementById("question-text");
    const questionMetaEl = document.getElementById("question-meta");
    const optionsContainerEl = document.getElementById("options-container");
    const progressTextEl = document.getElementById("progress-text");
    const answeredCountEl = document.getElementById("answered-count");
    const progressBarInnerEl = document.getElementById("progress-bar-inner");
    const tipTextEl = document.getElementById("tip-text");

    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const submitBtn = document.getElementById("submit-btn");

    const quizSectionEl = document.getElementById("quiz-section");
    const resultSectionEl = document.getElementById("result-section");

    const scoreLineEl = document.getElementById("score-line");
    const scoreTagEl = document.getElementById("score-tag");
    const scoreExtraEl = document.getElementById("score-extra");
    const resultDetailEl = document.getElementById("result-detail");

    const restartBtn = document.getElementById("restart-btn");
    const backEditBtn = document.getElementById("back-edit-btn");

    // ========== åˆå§‹åŒ– ==========
    function init() {
      if (!questions || questions.length === 0) {
        questionTextEl.textContent = "å½“å‰æ²¡æœ‰é¢˜ç›®ï¼Œè¯·åœ¨ JavaScript ä¸­æ·»åŠ é¢˜ç›®ã€‚";
        optionsContainerEl.innerHTML = "";
        return;
      }
      renderQuestion();
      updateProgress();
    }

    // è®¡ç®—å·²ç­”é¢˜ç›®æ•°é‡
    function getAnsweredCount() {
      return Object.keys(userAnswers).length;
    }

    // æ¸²æŸ“é¢˜ç›®
    function renderQuestion() {
      const q = questions[currentIndex];
      if (!q) return;

      questionTextEl.textContent = q.text;
      const typeLabel = q.type === "multi" ? "å¤šé€‰é¢˜" : "å•é€‰é¢˜";
      questionMetaEl.textContent = `${typeLabel} Â· ${q.score} åˆ†`;

      optionsContainerEl.innerHTML = "";
      const name = "q-" + currentIndex;
      const saved = userAnswers[currentIndex] || [];

      q.options.forEach(opt => {
        const li = document.createElement("li");
        li.className = "option-item";

        const label = document.createElement("label");
        label.className = "option-label";

        const input = document.createElement("input");
        input.type = q.type === "multi" ? "checkbox" : "radio";
        input.name = name;
        input.value = opt.key;
        if (saved.includes(opt.key)) {
          input.checked = true;
        }

        const spanKey = document.createElement("span");
        spanKey.style.fontWeight = "600";
        spanKey.textContent = opt.key + ".";

        const spanText = document.createElement("span");
        spanText.textContent = opt.text;

        label.appendChild(input);
        label.appendChild(spanKey);
        label.appendChild(spanText);

        li.appendChild(label);
        optionsContainerEl.appendChild(li);
      });

      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === questions.length - 1;
      updateProgress();
    }

    // ä¿å­˜å½“å‰é¢˜ç›®çš„ä½œç­”
    function saveCurrentAnswer() {
      const q = questions[currentIndex];
      if (!q) return;

      const selector = `input[name="q-${currentIndex}"]:checked`;
      const nodes = document.querySelectorAll(selector);
      const selected = Array.from(nodes).map(n => n.value);

      if (selected.length > 0) {
        userAnswers[currentIndex] = selected;
      } else {
        delete userAnswers[currentIndex];
      }
      updateProgress();
    }

    // æ›´æ–°è¿›åº¦æ¡ & æ–‡æœ¬
    function updateProgress() {
      const total = questions.length;
      const current = currentIndex + 1;
      const answered = getAnsweredCount();

      progressTextEl.textContent = `ç¬¬ ${current} é¢˜ / å…± ${total} é¢˜`;
      answeredCountEl.textContent = `å·²ç­”ï¼š${answered} é¢˜`;

      const percent = (answered / total) * 100;
      progressBarInnerEl.style.width = percent + "%";

      if (answered === total) {
        tipTextEl.textContent = "å·²ç­”å®Œæ‰€æœ‰é¢˜ç›®ï¼Œå¯ä»¥â€œQuiz DoneğŸ’“â€æŸ¥çœ‹ç»“æœå•¦ ğŸ‰";
      } else {
        tipTextEl.textContent = "ğŸŒ¬é£å‘çš„ä½ ï¼Œæœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œè¯·æ„Ÿå—æ¯ä¸€ä¸ªé€‰é¡¹ã€‚";
      }
    }

    // æäº¤è¯•å·
    function submitQuiz() {
      const total = questions.length;
      const answered = getAnsweredCount();
      if (answered < total) {
        const confirmContinue = confirm(
          `è¿˜æœ‰ ${total - answered} é¢˜æœªä½œç­”ï¼Œç¡®è®¤ä¹Ÿè¦æäº¤å—ï¼Ÿ`
        );
        if (!confirmContinue) return;
      }

      let totalScore = 0;
      let gotScore = 0;

      resultDetailEl.innerHTML = "";

      questions.forEach((q, index) => {
        totalScore += q.score;
        const userAns = userAnswers[index] || [];
        const hasAnswered = userAns.length > 0;
        const isCorrect = hasAnswered; // åªè¦æœ‰ä½œç­”å°±æ˜¯â€œæ­£ç¡®â€ï¼ˆåŠ åˆ†ï¼‰

        if (isCorrect) {
          gotScore += q.score;
        }

        const item = document.createElement("div");
        item.className = "result-item " + (isCorrect ? "correct" : "wrong");

        const title = document.createElement("div");
        title.className = "result-item-title";
        title.textContent = `ç¬¬ ${index + 1} é¢˜ï¼š${q.text}`;
        const tag = document.createElement("span");
        tag.className = isCorrect ? "tag-correct" : "tag-wrong";
        tag.textContent = isCorrect ? "å·²ä½œç­”" : "æœªä½œç­”";
        title.appendChild(tag);

        const yourAns = document.createElement("div");
        yourAns.textContent = "ä½ çš„é€‰æ‹©ï¼š" + (userAns.length ? userAns.join(", ") : "ï¼ˆæ²¡æœ‰ä½œç­”ï¼‰");

        const correct = document.createElement("div");
        if (q.answerText) {
          correct.textContent = q.answerText;
        } else {
          correct.textContent = "æ­£ç¡®ç­”æ¡ˆï¼šæ¯ä¸ªé€‰é¡¹éƒ½æ˜¯ä¸€ç§å¯çˆ±çš„é€‰æ‹©ã€‚";
        }

        const exp = document.createElement("div");
        exp.textContent = "è§£æï¼š" + (q.explanation || "æ— ");

        item.appendChild(title);
        item.appendChild(yourAns);
        item.appendChild(correct);
        item.appendChild(exp);

        resultDetailEl.appendChild(item);
      });

      const percent = Math.round((gotScore / totalScore) * 100);
      scoreLineEl.textContent = `æ€»åˆ† ${gotScore} / ${totalScore} åˆ†ï¼ˆæ­£ç¡®ç‡ï¼š${percent}%ï¼‰`;

      let comment = "";
      if (percent === 100) comment = "æ»¡åˆ†ã€‚è¯´æ˜ä½ è®¤çœŸåœ°çœ‹å®Œäº†æ‰€æœ‰å…³äºçˆ±çš„å°é—®é¢˜ ğŸ’˜";
      else if (percent >= 60) comment = "ä½ ç•™ä¸‹äº†ç©ºç™½çš„åœ°æ–¹ï¼Œä¹Ÿè®¸é‚£é‡Œæ­£å¥½æ˜¯ä½ åœ¨æ€è€ƒçš„éƒ¨åˆ†ã€‚";
      else comment = "åˆ†æ•°å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ä½ åˆšåˆšé‡æ–°çœ‹äº†ä¸€éè‡ªå·±å¯¹çˆ±å’Œå…³ç³»çš„å›ç­”ã€‚";

      scoreTagEl.textContent = comment;
      scoreExtraEl.textContent = `å…± ${questions.length} é¢˜ï¼Œä½ ä½œç­”äº† ${getAnsweredCount()} é¢˜ã€‚æ¯ä¸ªé€‰é¡¹éƒ½æ˜¯åŠ åˆ†é¡¹ã€‚`;

      quizSectionEl.classList.add("hidden");
      resultSectionEl.classList.remove("hidden");
    }

    // é‡æ–°å¼€å§‹
    function restartQuiz() {
      Object.keys(userAnswers).forEach(k => delete userAnswers[k]);
      currentIndex = 0;
      quizSectionEl.classList.remove("hidden");
      resultSectionEl.classList.add("hidden");
      renderQuestion();
      updateProgress();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // è¿”å›é¢˜ç›®ç»§ç»­æŸ¥çœ‹ / ä¿®æ”¹ç­”æ¡ˆ
    function backToQuiz() {
      quizSectionEl.classList.remove("hidden");
      resultSectionEl.classList.add("hidden");
      renderQuestion();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // ========== äº‹ä»¶ç»‘å®š ==========
    prevBtn.addEventListener("click", () => {
      saveCurrentAnswer();
      if (currentIndex > 0) {
        currentIndex--;
        renderQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      saveCurrentAnswer();
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      }
    });

    submitBtn.addEventListener("click", () => {
      saveCurrentAnswer();
      submitQuiz();
    });

    restartBtn.addEventListener("click", restartQuiz);
    backEditBtn.addEventListener("click", backToQuiz);

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
